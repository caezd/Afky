{"version":3,"file":"afky.esm.js","sources":["../src/index.js"],"sourcesContent":["import \"./style.css\";\r\n\r\nfunction forceFirstPaint(map) {\r\n    map.resize();\r\n    map.jumpTo({ center: map.getCenter(), zoom: map.getZoom() });\r\n    if (map.triggerRepaint) map.triggerRepaint();\r\n}\r\n\r\nfunction forceSkew() {\r\n    var curPage = 1;\r\n    var numOfPages = document.querySelectorAll(\".skw-page\").length;\r\n    var animTime = 1000;\r\n    var scrolling = false;\r\n    var pgPrefix = \".skw-page-\";\r\n\r\n    function pagination() {\r\n        scrolling = true;\r\n\r\n        var cur = document.querySelector(pgPrefix + curPage);\r\n        if (cur) {\r\n            cur.classList.remove(\"inactive\");\r\n            cur.classList.add(\"active\");\r\n        }\r\n\r\n        var prev = document.querySelector(pgPrefix + (curPage - 1));\r\n        if (prev) prev.classList.add(\"inactive\");\r\n\r\n        var next = document.querySelector(pgPrefix + (curPage + 1));\r\n        if (next) next.classList.remove(\"active\");\r\n\r\n        setTimeout(function () {\r\n            scrolling = false;\r\n        }, animTime);\r\n    }\r\n\r\n    function navigateUp() {\r\n        if (curPage === 1) return;\r\n        curPage--;\r\n        pagination();\r\n    }\r\n\r\n    function navigateDown() {\r\n        if (curPage === numOfPages) return;\r\n        curPage++;\r\n        pagination();\r\n    }\r\n\r\n    function onWheel(e) {\r\n        if (scrolling) return;\r\n        // wheel: deltaY>0 descend; mousewheel: wheelDelta>0 monte; DOMMouseScroll: detail<0 monte\r\n        var delta =\r\n            e.deltaY !== undefined ? -e.deltaY : e.wheelDelta || -e.detail;\r\n        if (delta > 0) {\r\n            navigateUp();\r\n        } else {\r\n            navigateDown();\r\n        }\r\n    }\r\n\r\n    function onKeydown(e) {\r\n        if (scrolling) return;\r\n        var code = e.which || e.keyCode;\r\n        if (code === 38 || e.key === \"ArrowUp\") {\r\n            navigateUp();\r\n        } else if (code === 40 || e.key === \"ArrowDown\") {\r\n            navigateDown();\r\n        }\r\n    }\r\n\r\n    document.addEventListener(\"wheel\", onWheel, { passive: true });\r\n    document.addEventListener(\"mousewheel\", onWheel, { passive: true });\r\n    document.addEventListener(\"DOMMouseScroll\", onWheel, { passive: true });\r\n    document.addEventListener(\"keydown\", onKeydown);\r\n\r\n    // Optionnel: renvoie une fonction de nettoyage si tu veux détacher les listeners plus tard\r\n    return function destroyForceSkew() {\r\n        document.removeEventListener(\"wheel\", onWheel);\r\n        document.removeEventListener(\"mousewheel\", onWheel);\r\n        document.removeEventListener(\"DOMMouseScroll\", onWheel);\r\n        document.removeEventListener(\"keydown\", onKeydown);\r\n    };\r\n}\r\n\r\nfunction main() {\r\n    new Honey({\r\n        index_box: function (data) {\r\n            console.log(data);\r\n            const maps = {};\r\n            const forums = {};\r\n            data.categories[0].forums.forEach(function (forum) {\r\n                forums[forum.name] = forum;\r\n                maps[forum.name] = new maplibregl.Map({\r\n                    container: `${forum.name}`,\r\n                    style: { version: 8, sources: {}, layers: [] },\r\n                    center: [0, 0],\r\n                    zoom: 2,\r\n                    minZoom: 0,\r\n                    maxZoom: 5,\r\n                    trackResize: true,\r\n                    attributionControl: false,\r\n                });\r\n            });\r\n            // loops des maps\r\n            for (const mapName in maps) {\r\n                const map = maps[mapName];\r\n\r\n                try {\r\n                    const forumRes = fetch(`/${forums[mapName]?.id}-forum`)\r\n                        .then((res) => res.text())\r\n                        .then((result) => {\r\n                            // 1) Parser le HTML\r\n                            const parser = new DOMParser();\r\n                            const doc = parser.parseFromString(\r\n                                result,\r\n                                \"text/html\"\r\n                            );\r\n\r\n                            // 2) Regex pour détecter [x,y] (espaces optionnels, décimaux, +/-)\r\n                            const coordRe =\r\n                                /\\[\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*\\]/;\r\n\r\n                            // 3) Récupérer tous les <a> qui matchent\r\n                            const anchors = Array.from(\r\n                                doc.querySelectorAll(\"a\")\r\n                            );\r\n                            const matches = anchors.filter((a) =>\r\n                                coordRe.test(a.textContent || \"\")\r\n                            );\r\n\r\n                            // 4a) Si tu veux juste l’HTML complet de chaque <a>\r\n                            const anchorsHTML = matches.map((a) => a.outerHTML);\r\n\r\n                            const anchorsWithCoords = matches.map((a) => {\r\n                                const m = (a.textContent || \"\").match(coordRe);\r\n                                const coords = m\r\n                                    ? [Number(m[1]), Number(m[2])]\r\n                                    : null;\r\n                                return {\r\n                                    outerHTML: a.outerHTML,\r\n                                    coords, // ex: [12.34, -56.78]\r\n                                    text: a.textContent?.trim() || \"\",\r\n                                    href: a.getAttribute(\"href\") || null,\r\n                                };\r\n                            });\r\n\r\n                            anchorsWithCoords.forEach((a) => {\r\n                                if (!a.coords) return;\r\n\r\n                                const el = document.createElement(\"div\");\r\n                                el.className = \"test-marker\";\r\n                                el.style.backgroundImage = `url('http://picsum.photos/25/25')`;\r\n                                const marker = new maplibregl.Marker({\r\n                                    element: el,\r\n                                })\r\n                                    .setLngLat(a.coords)\r\n                                    .setPopup(\r\n                                        new maplibregl.Popup({\r\n                                            offset: 16,\r\n                                        }).setHTML(\r\n                                            `<div class=\"marker-popup\"><strong>Position</strong><br/>${a.text}</div>`\r\n                                        )\r\n                                    )\r\n                                    .addTo(map);\r\n                                marker.setSubpixelPositioning(true);\r\n                            });\r\n                        });\r\n                } catch (e) {\r\n                    console.error(`Failed to fetch forum ${forumId}:`, e);\r\n                }\r\n\r\n                map.on(\"click\", (e) => {\r\n                    // The event object (e) contains information like the\r\n                    // coordinates of the point on the map that was clicked.\r\n                    console.log(\"A click event has occurred at \" + e.lngLat);\r\n                });\r\n\r\n                map.on(\"load\", () => {\r\n                    map.setRenderWorldCopies(false);\r\n                    map.addSource(\"r\", {\r\n                        type: \"raster\",\r\n                        tiles: [\r\n                            `http://127.0.0.1:8080/${mapName}/{z}/{y}/{x}.webp`,\r\n                        ],\r\n                        tileSize: 512,\r\n                        minzoom: 0,\r\n                        maxzoom: 3,\r\n                        scheme: \"xyz\",\r\n                    });\r\n                    map.addLayer({ id: \"r\", type: \"raster\", source: \"r\" });\r\n                    forceFirstPaint(map);\r\n                    forceSkew();\r\n                });\r\n            }\r\n\r\n            return data;\r\n        },\r\n    });\r\n}\r\nmain();\r\n"],"names":[],"mappings":"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"}